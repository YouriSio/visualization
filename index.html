<html>
	<head>
		<title>Test</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		body{margin: 0; }
		canvas { width:100%; height:100%; }
	</style>
	</head>

	<body>
		<script src="js/three.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/OBJLoader.js"></script>
		<script src="js/stats.min.js"></script>
		<script src="docs/path.js"></script>

		<script>
			//Get keyframe arrays from path.js
			function getColumn(matrix, col){
                var column = [];
                for(var i=0; i<matrix.length; i++){
                    column.push(matrix[i][col]);
                }
                return column;
            }

            var keyFrameTimes = getColumn(path, 0);
            keyFrameTimes = keyFrameTimes.map(function (x) { 
                return parseFloat(x);
            });

            var keyFrameVectors = path.map(function(val){
                return val.slice(1, 4);
			});
			
			keyFrameVectors = keyFrameVectors.map(function(val) {
				return [val[1], val[2], val[0]];
			});

            keyFrameVectors = [].concat(...keyFrameVectors);

            keyFrameVectors = keyFrameVectors.map(function (x) { 
                return parseFloat(x)*2; 
			});
			
			//
			var stats, clock;
			var scene, camera, renderer, mixer;
			init();
			animate();
			function init() {
				scene = new THREE.Scene();

				//Setup camera
				camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.set( 20, 10, 20 );
				camera.lookAt( scene.position );

				//Floor
				var soccerfieldWidth = 50;
				var soccerfieldLength = 1.4 * soccerfieldWidth;
				var soccerfieldThickness = 1;
				var floorGeometry = new THREE.CubeGeometry(soccerfieldLength,soccerfieldThickness,soccerfieldWidth);
				var floorMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/soccerfield.jpg'), side:THREE.DoubleSide } );
				var floorCube = new THREE.Mesh( floorGeometry, floorMaterial );
				scene.add( floorCube );

				function createPole() {
					var poleGeometry = new THREE.CubeGeometry(1,5,1);
					var poleMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/shinypost.jpg'), side:THREE.DoubleSide } );
					return new THREE.Mesh( poleGeometry, poleMaterial );
				}
				
				function createGoal() {
					var crossbarGeometry = new THREE.CubeGeometry(1,1,10);
					var goalMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/shinypost.jpg'), side:THREE.DoubleSide } );
					var crossbar = new THREE.Mesh( crossbarGeometry, goalMaterial );
					
					var leftPole = createPole();
					leftPole.position.z = -5;
					leftPole.position.y = -2;

					var rightPole = createPole();
					rightPole.position.z = 5;
					rightPole.position.y = -2

					var goal = new THREE.Group();

					goal.add(leftPole);
					goal.add(rightPole);
					goal.add(crossbar);
					
					return goal;
				}
				
				var leftGoal = createGoal();
				leftGoal.position.x = -(soccerfieldLength/2-5);
				leftGoal.position.y = 5;
				scene.add(leftGoal);

				var rightGoal = createGoal();
				rightGoal.position.x = (soccerfieldLength/2-5);
				rightGoal.position.y = 5;
				scene.add(rightGoal);

				var axesHelper = new THREE.AxesHelper( 20 );
				scene.add( axesHelper );
				//Load drone mesh
				var loader = new THREE.OBJLoader();
				var drone = new THREE.Object3D();
				loader.load('models/Avular_V2_Zero.obj', function( object ) {
					object.scale.set(.005,.005,.005);
					object.rotation.x = -1.57079632679;

					var mat = new THREE.MeshLambertMaterial({
						//vertexColors: THREE.FaceColors,
						overdraw: 0.5,
						color: 0XFF0000
					});

					object.traverse(function(child) {
						if (child instanceof THREE.Mesh) {
							child.material = mat;
						}
						drone = object;
					});
					
					scene.add( drone );

					//Section animation
					var positionKF = new THREE.VectorKeyframeTrack( '.position', keyFrameTimes, keyFrameVectors );
					var clip = new THREE.AnimationClip( 'Action', 3, [ positionKF] );
					mixer = new THREE.AnimationMixer( drone );
					var clipAction = mixer.clipAction( clip );
					clipAction.play();
				});

				//Light
				var ambientLight = new THREE.AmbientLight(0xFFFFFF, 0.8);

				scene.add( ambientLight );

				var directionalLight = new THREE.DirectionalLight(0XFFFFFF,1);
				directionalLight.position.set( 0,1,0 );
				scene.add( directionalLight );

				
				//
				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );

				controls = new THREE.OrbitControls( camera, renderer.domElement );
				
				//Stats
				stats = new Stats();
				document.body.appendChild( stats.dom );
				
				clock = new THREE.Clock();
				
				window.addEventListener( 'resize', onWindowResize, false );
			}

			//draw scene
			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}
			function animate() {
				requestAnimationFrame( animate );
				render();
			}
			function render() {
				var delta = clock.getDelta();
				if ( mixer ) {
					mixer.update( delta );
				}
				renderer.render( scene, camera );
				stats.update();
			}
		</script>
	</body>
</html>