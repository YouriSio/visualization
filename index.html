<html>
	<head>
		<title>Test</title>
	

	<style>
		body{margin: 0; }
		canvas { width:100%; heigh:100%; }
	</style>
	</head>

	<body>
		<script src="js/three.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/OBJLoader.js"></script>
		<script src="js/AssimpJSONLoader.js"></script>
		<script src="js/Tween.js"></script>
		<script src="js/WayCalc.js"></script>
		<script src="js/DroneAnimate.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.2/TweenMax.min.js"></script>

		<script>
			(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//rawgit.com/mrdoob/stats.js/master/build/stats.min.js';document.head.appendChild(script);})()

			var manager = new THREE.LoadingManager(manager);

			manager.onProgress = function ( url, itemsLoaded, itemsTotal ) {

				console.log( 'Loading file: ' + url + '.\nLoaded ' + itemsLoaded + ' of ' + itemsTotal + ' files.' );
				
			};

			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
			var renderer = new THREE.WebGLRenderer();
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild( renderer.domElement );

			window.addEventListener( 'resize',function()
			{
				var width = window.innerHeight;
				var height = window.innerHeight;
				renderer.setSize( width, height );
				camera.aspect = width / height;
				camera.updateProjectionMatrix(  );
			} );

			controls = new THREE.OrbitControls( camera, renderer.domElement );

			
			var loader = new THREE.OBJLoader(manager);
			var drone = new THREE.Object3D();
			var manager = new THREE.LoadingManager();
			
			loader.load(
				'models/Avular_V2_Zero.obj',
				
				function( object ) {
						object.scale.set(.005,.005,.005);
						object.rotation.x = -1.57079632679;
						object.position.y = -4.5;

						var mat = new THREE.MeshLambertMaterial({
        					//vertexColors: THREE.FaceColors,
        					overdraw: 0.5,
        					color: 0XFF0000

        				});
        				object.traverse(function(child) {
        					if (child instanceof THREE.Mesh) {
            						child.material = mat;
        						}
        					drone = object;
    					});
						
						scene.add( drone );

				});
			 

					
			camera.position.z = 3; 

			//Floor
			var floorGeometry = new THREE.CubeGeometry(100,1,50);
			var floorMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/soccerfield.jpg'), side:THREE.DoubleSide } );
			var floorCube = new THREE.Mesh( floorGeometry, floorMaterial );
			floorCube.position.y = -5;
			scene.add( floorCube );
			//LeftPoleL
			var leftWallLGeometry = new THREE.CubeGeometry(1,5,1);
			var leftWallLMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/shinypost.jpg'), side:THREE.DoubleSide } );
			var leftWallLCube = new THREE.Mesh( leftWallLGeometry, leftWallLMaterial );
			leftWallLCube.position.x = -42;
			leftWallLCube.position.z = -5;
			leftWallLCube.position.y = -2;
			scene.add( leftWallLCube );

			//LeftPoleR
			var leftWallRGeometry = new THREE.CubeGeometry(1,5,1);
			var leftWallRMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/shinypost.jpg'), side:THREE.DoubleSide } );
			var leftWallRCube = new THREE.Mesh( leftWallRGeometry, leftWallRMaterial );
			leftWallRCube.position.x = -42;
			leftWallRCube.position.z = 5;
			leftWallRCube.position.y = -2;
			scene.add( leftWallRCube );
			//Left Crossbar
			var leftCrossbarGeometry = new THREE.CubeGeometry(1,1,10);
			var leftCrossbarMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/shinypost.jpg'), side:THREE.DoubleSide } );
			var leftCrossbar = new THREE.Mesh( leftCrossbarGeometry, leftCrossbarMaterial );
			leftCrossbar.position.x = -42;
			leftCrossbar.position.z = 0;
			leftCrossbar.position.y = 0;
			scene.add( leftCrossbar );

			//RightPoleL
			var rightWallLGeometry = new THREE.CubeGeometry(1,5,1);
			var rightWallLMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/shinypost.jpg'), side:THREE.DoubleSide } );
			var rightWallLCube = new THREE.Mesh( rightWallLGeometry, rightWallLMaterial );
			rightWallLCube.position.x = 42;
			rightWallLCube.position.z = -5;
			rightWallLCube.position.y = -2;
			scene.add( rightWallLCube );
			//RightPoleR
			var rightWallRGeometry = new THREE.CubeGeometry(1,5,1);
			var rightWallRMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/shinypost.jpg'), side:THREE.DoubleSide } );
			var rightWallRCube = new THREE.Mesh( rightWallRGeometry, rightWallRMaterial );
			rightWallRCube.position.x = 42;
			rightWallRCube.position.z = 5;
			rightWallRCube.position.y = -2;
			scene.add( rightWallRCube );
			//RightCrossbar
			var rightCrossbarGeometry = new THREE.CubeGeometry(1,1,10);
			var rightCrossbarMaterial = new THREE.MeshLambertMaterial( { map: new THREE.TextureLoader().load('img/shinypost.jpg'), side:THREE.DoubleSide } );
			var rightCrossbar = new THREE.Mesh( rightCrossbarGeometry, rightCrossbarMaterial );
			rightCrossbar.position.x = 42;
			rightCrossbar.position.z = 0;
			rightCrossbar.position.y = 0;
			scene.add( rightCrossbar );


			readTextFile("docs/trajx.csv");

			//Light
			var ambientLight = new THREE.AmbientLight(0xFFFFFF, 0.8);

			scene.add( ambientLight );


			var directionalLight = new THREE.DirectionalLight(0XFFFFFF,1);
			directionalLight.position.set( 0,1,0 );
			scene.add( directionalLight );

			
			//game logic
			setTimeout(function(){
				var tween = new TWEEN.Tween({x: 0,y: -4.5, z:0, rotationx:-1.57079632679}).to({rotationx:-1.57079632679, x: 0, y: 10, z:0}, 10000).onUpdate( function(){
					drone.position.x = this.x;
					drone.position.y = this.y;
					drone.position.z = this.z;
				}).chain(new TWEEN.Tween({x: 0,y: 10, z:0, rotationx:-1.57079632679}).to({rotationx:-1.57079632679, x: 10, y: 10, z:0}, 10000).onUpdate( function(){
					drone.position.x = this.x;
					drone.position.y = this.y;
					drone.position.z = this.z;})).start();
			}, 2000);


			var update = function( )
			{
				
			};
			//draw scene
			var render = function()
			{
				renderer.render( scene, camera );
			};

			var animate = function( )
			{
				requestAnimationFrame( animate );
				TWEEN.update()
				update();
				render();
			};

			animate();
		</script>
	</body>
</html>